<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Mes Prêts - G-Prêt Biblio</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
</head>
<body>

<!-- Barre de navigation réutilisée (copier-coller pour l'instant) -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container-fluid">
        <a class="navbar-brand" href="#"><i class="bi bi-book-half"></i> Boky</a>
        <div class="collapse navbar-collapse">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <!-- Lien vers le catalogue (n'est plus la page active) -->
                <li class="nav-item"><a class="nav-link" th:href="@{/user/dashboard/{id}(id=${userId})}">Catalogue</a></li>
                <!-- Lien "Mes Prêts" est maintenant actif -->
                <li class="nav-item"><a class="nav-link active" th:href="@{/user/mes-prets}">Mes Prêts</a></li>
            </ul>
            <form th:action="@{/logout}" method="post">
                <button type="submit" class="btn btn-outline-light">
                    <i class="bi bi-box-arrow-right"></i> Se déconnecter
                </button>
            </form>
        </div>
    </div>
</nav>

<div class="container mt-4">
    <h1 class="mb-4"><i class="bi bi-list-task"></i> Mon Historique de Prêts</h1>

    <div class="card">
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>Livre</th>
                            <th>Date d'emprunt</th>
                            <th>Date de retour prévue</th>
                            <th>Date de retour réelle</th>
                            <th>Statut</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="pret : ${prets}" th:classappend="${pret.statutPret?.nom == 'En retard'} ? 'table-danger' : ''">
                            <td th:text="${pret.livre?.titre}">Titre du Livre</td>
                            <td th:text="${#dates.format(pret.dateEmprunt, 'dd/MM/yyyy')}"></td>
                            <td th:text="${#dates.format(pret.dateRetourPrevue, 'dd/MM/yyyy')}"></td>
                            <td th:text="${pret.dateRetourReelle != null} ? ${#dates.format(pret.dateRetourReelle, 'dd/MM/yyyy')} : '-'"></td>
                            <td>
                                <span th:switch="${pret.statutPret?.nom}">
                                    <span th:case="'En cours'" class="badge bg-primary">En cours</span>
                                    <span th:case="'Retourné'" class="badge bg-success">Retourné</span>
                                    <span th:case="'En retard'" class="badge bg-danger">En retard</span>
                                </span>
                            </td>
                            <td>
                                <!-- Action "Prolonger" si le prêt est en cours -->
                                <button th:if="${pret.statutPret?.nom == 'En cours'}" class="btn btn-sm btn-info">
                                    <i class="bi bi-calendar-plus"></i> Prolonger
                                </button>
                                <!-- Action "Rendre" (à implémenter plus tard) -->
                                <button th:if="${pret.statutPret?.nom == 'En cours' or pret.statutPret?.nom == 'En retard'}" class="btn btn-sm btn-success">
                                    <i class="bi bi-check2-circle"></i> Rendre
                                </button>
                            </td>
                        </tr>
                        <tr th:if="${#lists.isEmpty(prets)}">
                            <td colspan="6" class="text-center p-4">Vous n'avez aucun prêt pour le moment.</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<footer class="py-3 my-4">
    <p class="text-center text-muted">© 2025 Gestion Prêt Bibliothèque</p>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>